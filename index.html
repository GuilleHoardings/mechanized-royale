<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechanized Royale</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <button class="debug-toggle" onclick="toggleDebugPanel()">Toggle Debug</button>
    <button class="row-numbers-toggle" onclick="toggleRowNumbers()">Toggle Row Numbers</button>
    <button class="attack-range-toggle" onclick="toggleAttackRanges()">Toggle Attack Ranges</button>
    <button class="textures-toggle" onclick="toggleTextures()">Toggle Textures</button>
    <button class="speed-toggle" id="speed-toggle" onclick="cycleGameSpeed()" disabled>Speed: 1.00x</button>
    <button class="pause-toggle" id="pause-toggle" onclick="togglePause()" disabled>⏸ Pause</button>
    
    <div id="game-container">
        <div id="loading">
            <h2>Mechanized Royale</h2>
            <p>Loading...</p>
        </div>
    </div>
    
    <div id="debug-panel">
        <div class="debug-section">
            <div class="debug-title">Game State</div>
            <div class="debug-item">
                <span class="debug-label">Scene:</span>
                <span class="debug-value" id="debug-scene">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Battle Time:</span>
                <span class="debug-value" id="debug-time">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Game Paused:</span>
                <span class="debug-value" id="debug-paused">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Player Stats</div>
            <div class="debug-item">
                <span class="debug-label">Energy:</span>
                <span class="debug-value" id="debug-player-energy">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Tanks Alive:</span>
                <span class="debug-value" id="debug-player-tanks">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Hand Cards:</span>
                <span class="debug-value" id="debug-player-hand">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">AI Stats</div>
            <div class="debug-item">
                <span class="debug-label">Energy:</span>
                <span class="debug-value" id="debug-ai-energy">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Tanks Alive:</span>
                <span class="debug-value" id="debug-ai-tanks">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Strategy:</span>
                <span class="debug-value" id="debug-ai-strategy">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Rush Mode:</span>
                <span class="debug-value" id="debug-ai-rush">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Battle Stats</div>
            <div class="debug-item">
                <span class="debug-label">Total Tanks:</span>
                <span class="debug-value" id="debug-total-tanks">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Projectiles:</span>
                <span class="debug-value" id="debug-projectiles">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Buildings:</span>
                <span class="debug-value" id="debug-buildings">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Performance</div>
            <div class="debug-item">
                <span class="debug-label">FPS:</span>
                <span class="debug-value" id="debug-fps">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Objects:</span>
                <span class="debug-value" id="debug-objects">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Memory:</span>
                <span class="debug-value" id="debug-memory">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Tower Status</div>
            <div class="debug-item">
                <span class="debug-label">Player Towers:</span>
                <span class="debug-value" id="debug-player-towers">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">AI Towers:</span>
                <span class="debug-value" id="debug-ai-towers">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Deployment Zones</div>
            <div class="debug-item">
                <span class="debug-label">Player Expanded:</span>
                <span class="debug-value" id="debug-player-expanded">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">AI Expanded:</span>
                <span class="debug-value" id="debug-ai-expanded">-</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">Debug Options</div>
            <div class="debug-item">
                <span class="debug-label">Textures Mode:</span>
                <span class="debug-value" id="debug-textures-mode">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Row Numbers:</span>
                <span class="debug-value" id="debug-row-numbers">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Attack Ranges:</span>
                <span class="debug-value" id="debug-attack-ranges">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Speed:</span>
                <span class="debug-value" id="debug-speed">1.00x</span>
            </div>
        </div>
    </div>

    <script>
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            panel.classList.toggle('visible');
        }
        
        function toggleRowNumbers() {
            // Send message to game to toggle row numbers
            if (window.currentScene && window.currentScene.toggleRowNumbers) {
                window.currentScene.toggleRowNumbers();
            }
        }
        
        function toggleAttackRanges() {
            // Send message to game to toggle attack range circles
            if (window.currentScene && window.currentScene.toggleAttackRanges) {
                window.currentScene.toggleAttackRanges();
            }
        }
        
        function toggleTextures() {
            // Send message to game to toggle textures mode
            if (window.currentScene && window.currentScene.toggleTextures) {
                window.currentScene.toggleTextures();
            }
        }

        function togglePause() {
            // Send message to game to toggle pause
            if (window.currentScene && window.currentScene.togglePause) {
                window.currentScene.togglePause();
            }
        }

        function updatePauseButtonState(isPaused) {
            const button = document.getElementById('pause-toggle');
            if (!button) return;
            if (isPaused) {
                button.textContent = '▶ Resume';
                button.classList.add('paused');
            } else {
                button.textContent = '⏸ Pause';
                button.classList.remove('paused');
            }
        }

        function refreshPauseButtonState() {
            const button = document.getElementById('pause-toggle');
            if (!button) return;
            const scene = window.currentScene;
            const hasControl = scene && typeof scene.togglePause === 'function';
            button.disabled = !hasControl;
            const isPaused = hasControl && scene.isPaused && scene.isPaused();
            updatePauseButtonState(isPaused);
            button.title = hasControl ? 'Pause/Resume game for analysis' : 'Available during battles';
        }

        window.updatePauseButtonState = updatePauseButtonState;
        window.refreshPauseButtonState = refreshPauseButtonState;

        function updateSpeedButtonLabel(speed) {
            const button = document.getElementById('speed-toggle');
            if (!button) return;
            const displaySpeed = typeof speed === 'number' ? speed : 1;
            button.textContent = `Speed: ${displaySpeed.toFixed(2)}x`;
            if (displaySpeed < 1) {
                button.classList.add('speed-slow');
            } else {
                button.classList.remove('speed-slow');
            }
        }

        function refreshSpeedButtonState() {
            const button = document.getElementById('speed-toggle');
            if (!button) return;
            const scene = window.currentScene;
            const hasControl = scene && typeof scene.toggleSimulationSpeed === 'function';
            button.disabled = !hasControl;
            const speed = hasControl && typeof scene.getSimulationSpeed === 'function'
                ? scene.getSimulationSpeed()
                : 1;
            updateSpeedButtonLabel(speed);
            button.title = hasControl ? 'Cycle through analysis-friendly slow speeds' : 'Available during battles';
        }

        function cycleGameSpeed() {
            const scene = window.currentScene;
            if (!scene || typeof scene.toggleSimulationSpeed !== 'function') {
                return;
            }
            scene.toggleSimulationSpeed();
        }

        window.updateSpeedButtonLabel = updateSpeedButtonLabel;
        window.refreshSpeedButtonState = refreshSpeedButtonState;

        refreshSpeedButtonState();
        refreshPauseButtonState();
        
        // Make debug functions globally accessible
        window.debugPanel = {
            updateValue: function(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    // Add warning class for critical values
                    element.classList.remove('debug-warning');
                    if (this.isWarningValue(id, value)) {
                        element.classList.add('debug-warning');
                    }
                }
            },
            
            isWarningValue: function(id, value) {
                if (id === 'debug-fps' && parseFloat(value) < 30) return true;
                if (id === 'debug-player-energy' && parseFloat(value) === 0) return true;
                if (id === 'debug-ai-energy' && parseFloat(value) === 0) return true;
                if (id.includes('tanks') && parseFloat(value) > 20) return true;
                return false;
            }
        };
    </script>

    <!-- Phaser 3 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <!-- Game Scripts -->
    <script src="src/utils/constants.js"></script>
    <script src="src/utils/helpers.js"></script>
    <script src="src/utils/pathfinding.js"></script>
    <script src="src/utils/UIManager.js"></script>
    <script src="src/utils/GraphicsManager.js"></script>
    <script src="src/utils/CombatSystem.js"></script>
    <script src="src/utils/AIController.js"></script>
    <script src="src/data/cards.js"></script>
    <script src="src/data/tanks.js"></script>
    <script src="src/scenes/BootScene.js"></script>
    <script src="src/scenes/MenuScene.js"></script>
    <script src="src/scenes/BattleScene.js"></script>
    <script src="src/main.js"></script>
</body>
</html>
